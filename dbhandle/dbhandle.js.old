//this module is for the db handle use first create at 2012-3-6

var model = require('./dbinit.js'),
    User = model.User,
    OrderList = model.OrderList;

//dealing with some of the advance function, like reporting and so on

//user handle

var createUser = function(obj, cb){
    var tmp = new User();
    tmp.init(obj);
    tmp.save(function(err){
        if(!err){
            console.log('save success');
            cb();
        }else{
            console.log('save failed');
            console.log('error:' + err);
        }
    });
};

var updateUser = function(id, obj, cb){
    var conditions = {_id: id},
        update = obj,
        options = {multi: false};
    User.update(conditions,update,options,callback);
    function callback(err,numAffected){
        if(!err){
            console.log('update success');
            cb();
        }else{
            console.log('update failed');
            console.log('error:' + err);
        }
    }
};

var removeUser = function(id,cb){
    var conditions = {_id: id};
    User.remove(conditions,callback);
    function callback(err){
        if(!err){
            console.log('remove success');
            cb();
        }else{
            console.log('remove failed');
            console.log('error:' + err);
        }
    }
};

var queryUser = function(name,cb){
    User.findOne({username: 'woody'}, cb);
};

//book handle


exports.createUser = createUser;
exports.updateUser = updateUser;
exports.removeUser = removeUser;
exports.queryUser = queryUser;
